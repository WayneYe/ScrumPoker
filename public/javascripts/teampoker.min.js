/* Scrum Team Poker - A realtime web application powered by node/express and Socket.IO.
* version 3.2.0 - 2021-01-19
* Copyright (c) 2011 - 2021 Wayne Ye - http://wayneye.com
* Licensed with MIT */

!function(){"use strict";function u(e){return e.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function p(e){return 10<=parseFloat(u(e))}function c(e){var t;e=e||window.event,this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement),I.activate(t)}function h(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&"string"==typeof t){var o=(t||"").split(/\s+/);if(1===e.nodeType)if(e.className){for(var n=" "+e.className+" ",r=e.className,i=0,a=o.length;i<a;i++)n.indexOf(" "+o[i]+" ")<0&&(r+=" "+o[i]);e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=t}return e}function f(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if(t&&"string"==typeof t||void 0===t){var o=(t||"").split(/\s+/);if(1===e.nodeType&&e.className)if(t){for(var n=(" "+e.className+" ").replace(/[\n\t]/g," "),r=0,i=o.length;r<i;r++)n=n.replace(" "+o[r]+" "," ");e.className=n.replace(/^\s+|\s+$/g,"")}else e.className=""}return e}function o(e,t){var o,n,r,i,t={left:0,top:0,width:0,height:0,zIndex:T(t)-1};return e.getBoundingClientRect&&(e=e.getBoundingClientRect(),r="pageXOffset"in window&&"pageYOffset"in window?(o=window.pageXOffset,window.pageYOffset):(i=1,"function"==typeof document.body.getBoundingClientRect&&(n=(r=document.body.getBoundingClientRect()).right-r.left,r=document.body.offsetWidth,i=Math.round(n/r*100)/100),n=i,o=Math.round(document.documentElement.scrollLeft/n),Math.round(document.documentElement.scrollTop/n)),i=document.documentElement.clientLeft||0,n=document.documentElement.clientTop||0,t.left=e.left+o-i,t.top=e.top+r-n,t.width="width"in e?e.width:e.right-e.left,t.height="height"in e?e.height:e.bottom-e.top),t}function d(e,t,o){if("function"==typeof t.indexOf)return t.indexOf(e,o);var n,r=t.length;for(void 0===o?o=0:o<0&&(o=r+o),n=o;n<r;n++)if(t.hasOwnProperty(n)&&t[n]===e)return n;return-1}function m(e){if("string"==typeof e)throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]}function n(e,t){e&&!1!==t&&"undefined"!=typeof console&&console&&(console.warn||console.log)&&(e="`"+e+"` is deprecated. See docs for more info:\n    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations",console.warn?console.warn(e):console.log(e))}function r(){for(var e,t,o,n=arguments[0]||{},r=1,i=arguments.length;r<i;r++)if(null!=(e=arguments[r]))for(t in e)if(e.hasOwnProperty(t)){if(n[t],n===(o=e[t]))continue;void 0!==o&&(n[t]=o)}return n}function l(e){if(null==e)return[];if(Object.keys)return Object.keys(e);var t,o=[];for(t in e)e.hasOwnProperty(t)&&o.push(t);return o}function i(){var e=!1;if("boolean"==typeof y.noflash)e=!1===y.noflash;else{if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(e){}!e&&navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0)}return e}var g,a,t,y={bridge:null,version:"0.0.0",noflash:null,wrongflash:null,ready:null},v={},s=0,P={},k=0,b={},w=(t=/\-([a-z])/g,function(e){return e.replace(t,L)}),T=function(e){var t,o;return e&&("number"==typeof e&&0<e?t=e:"string"==typeof e&&(o=parseInt(e,10))&&!isNaN(o)&&0<o&&(t=o)),t||("number"==typeof M.zIndex&&0<M.zIndex?t=M.zIndex:"string"==typeof M.zIndex&&(o=parseInt(M.zIndex,10))&&!isNaN(o)&&0<o&&(t=o)),t||0},C=function(e){if(null==e||""===e)return null;if(""===(e=e.replace(/^\s+|\s+$/g,"")))return null;var t=e.indexOf("//"),o=(e=-1===t?e:e.slice(t+2)).indexOf("/");return(!(e=-1===o?e:-1===t||0===o?null:e.slice(0,o))||".swf"!==e.slice(-4).toLowerCase())&&e||null},S=(a={always:"always",samedomain:"sameDomain",never:"never"},function(e,t){var o=t.allowScriptAccess;if("string"==typeof o&&(n=o.toLowerCase())&&/^always|samedomain|never$/.test(n))return a[n];o=C(t.moviePath);null===o&&(o=e);var n=[];V(t.trustedOrigins,n),V(t.trustedDomains,n);t=n.length;if(0<t){if(1===t&&"*"===n[0])return"always";if(-1!==d(e,n))return 1===t&&e===o?"sameDomain":"always"}return"never"}),I=function(e,t){return this instanceof I?(this.id=""+s++,P[this.id]={instance:this,elements:[],handlers:{}},e&&this.glue(e),void 0!==t&&(n("new ZeroClipboard(elements, options)",M.debug),I.config(t)),this.options=I.config(),"boolean"!=typeof y.noflash&&(y.noflash=!i()),void(!1===y.noflash&&!0!==y.wrongflash&&null===y.bridge&&(y.wrongflash=!1,y.ready=!1,O()))):new I(e,t)};function V(e,t){var o,n,r;if(null!=e&&"*"!==t[0]&&("string"==typeof e&&(e=[e]),"object"==typeof e&&"length"in e))for(o=0,n=e.length;o<n;o++)if(e.hasOwnProperty(o)&&(r=C(e[o]))){if("*"===r){t.length=0,t.push("*");break}-1===d(r,t)&&t.push(r)}}function L(e,t){return t.toUpperCase()}function $(e){!0===y.ready&&y.bridge&&y.bridge.setHandCursor(e)}I.prototype.setText=function(e){return e&&""!==e&&(v["text/plain"]=e,!0===y.ready&&y.bridge&&y.bridge.setText(e)),this},I.prototype.setSize=function(e,t){return!0===y.ready&&y.bridge&&y.bridge.setSize(e,t),this},I.prototype.destroy=function(){this.unglue(),this.off(),delete P[this.id]},I.version="1.3.0-beta.1";var M={moviePath:"ZeroClipboard.swf",trustedDomains:window.location.host?[window.location.host]:[],useNoCache:!0,forceHandCursor:!1,zIndex:999999999,debug:!0,title:null};I.config=function(e){if("object"==typeof e&&null!==e&&r(M,e),"string"!=typeof e||!e){var t,o={};for(t in M)M.hasOwnProperty(t)&&(o[t]="object"==typeof M[t]&&null!==M[t]?"length"in M[t]?M[t].slice(0):r({},M[t]):M[t]);return o}if(M.hasOwnProperty(e))return M[e]},I.destroy=function(){for(var e in I.deactivate(),P){var t;P.hasOwnProperty(e)&&P[e]&&((t=P[e].instance)&&"function"==typeof t.destroy&&t.destroy())}var o=E(y.bridge);o&&o.parentNode&&(o.parentNode.removeChild(o),y.ready=null,y.bridge=null)},I.activate=function(e){g&&(f(g,M.hoverClass),f(g,M.activeClass)),h(g=e,M.hoverClass),R();var t,o=M.title||e.getAttribute("title");!o||(t=E(y.bridge))&&t.setAttribute("title",o);var n,n=!0===M.forceHandCursor||"pointer"===(o=e,e="cursor",n=window.getComputedStyle?window.getComputedStyle(o,null).getPropertyValue(e):(n=w(e),(o.currentStyle||o.style)[n]),"cursor"!==e||n&&"auto"!==n||"a"!==o.tagName.toLowerCase()?n:"pointer");$(n)},I.deactivate=function(){var e=E(y.bridge);e&&(e.style.left="0px",e.style.top="-9999px",e.removeAttribute("title")),g&&(f(g,M.hoverClass),f(g,M.activeClass),g=null)};var x=null,U=null,O=function(){var e,t,o,n,r,i=document.getElementById("global-zeroclipboard-html-bridge");i||((r=I.config()).amdModuleId=x,r.cjsModuleId=U,t=S(window.location.host,M),o=function(e){var t,o,n,r=[],i=[],a=[];if(e.trustedOrigins&&("string"==typeof e.trustedOrigins?i.push(e.trustedOrigins):"object"==typeof e.trustedOrigins&&"length"in e.trustedOrigins&&(i=i.concat(e.trustedOrigins))),e.trustedDomains&&("string"==typeof e.trustedDomains?i.push(e.trustedDomains):"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(i=i.concat(e.trustedDomains))),i.length)for(t=0,o=i.length;t<o;t++)if(i.hasOwnProperty(t)&&i[t]&&"string"==typeof i[t]){if(!(n=C(i[t])))continue;if("*"===n){a=[n];break}a.push.apply(a,[n,"//"+n,window.location.protocol+"//"+n])}return a.length&&r.push("trustedOrigins="+encodeURIComponent(a.join(","))),"string"==typeof e.amdModuleId&&e.amdModuleId&&r.push("amdModuleId="+encodeURIComponent(e.amdModuleId)),"string"==typeof e.cjsModuleId&&e.cjsModuleId&&r.push("cjsModuleId="+encodeURIComponent(e.cjsModuleId)),r.join("&")}(r),o='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+(n=M.moviePath+(n=M.moviePath,!((r=M)&&!1===r.useNoCache)?(-1===n.indexOf("?")?"?":"&")+"nocache="+(new Date).getTime():""))+'"/>         <param name="allowScriptAccess" value="'+t+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+o+'"/>         <embed src="'+n+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+t+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+o+'"           scale="exactfit">         </embed>       </object>',(i=document.createElement("div")).id="global-zeroclipboard-html-bridge",i.setAttribute("class","global-zeroclipboard-container"),i.style.position="absolute",i.style.left="0px",i.style.top="-9999px",i.style.width="15px",i.style.height="15px",i.style.zIndex=""+T(M.zIndex),document.body.appendChild(i),i.innerHTML=o),(o=document["global-zeroclipboard-flash-bridge"])&&(e=o.length)&&(o=o[e-1]),y.bridge=o||i.children[0].lastElementChild},E=function(e){for(var t=/^object|embed$/,o=e&&e.parentNode;o&&t.test(o.tagName.toLowerCase())&&o.parentNode;)o=o.parentNode;return o||null},R=function(){var e,t;return g&&(e=o(g,M.zIndex),(t=E(y.bridge))&&(t.style.top=e.top+"px",t.style.left=e.left+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.zIndex=e.zIndex+1),!0===y.ready&&y.bridge&&y.bridge.setSize(e.width,e.height)),this};I.dispatch=function(e,t){if("string"==typeof e&&e){var o=e.toLowerCase().replace(/^on/,"");if(o)for(var n=g?N(g):function(){for(var e,t=[],o=l(P),n=0,r=o.length;n<r;n++)(e=P[o[n]].instance)&&e instanceof I&&t.push(e);return t}(),r=0,i=n.length;r<i;r++)D.call(n[r],o,t)}},I.prototype.on=function(e,t){for(var o=e.toString().split(/\s+/),n={},r=P[this.id]&&P[this.id].handlers,i=0,a=o.length;i<a;i++)n[e=o[i].toLowerCase().replace(/^on/,"")]=!0,r[e]||(r[e]=[]),r[e].push(t);return n.noflash&&y.noflash&&D.call(this,"onNoFlash",{}),n.wrongflash&&y.wrongflash&&D.call(this,"onWrongFlash",{flashVersion:y.version}),n.load&&y.ready&&D.call(this,"onLoad",{flashVersion:y.version}),this},I.prototype.off=function(e,t){var o,n,r,i,a,s=P[this.id]&&P[this.id].handlers;if(0===arguments.length?i=l(s):"string"==typeof e&&e&&(i=e.split(/\s+/)),i&&i.length)for(o=0,n=i.length;o<n;o++)if((a=s[e=i[o].toLowerCase().replace(/^on/,"")])&&a.length)if(t)for(r=d(t,a);-1!==r;)a.splice(r,1),r=d(t,a,r);else s[e].length=0;return this},I.prototype.handlers=function(e){var t,o=null,n=P[this.id]&&P[this.id].handlers;if(n){if("string"==typeof e&&e)return n[e]?n[e].slice(0):null;for(t in o={},n)n.hasOwnProperty(t)&&n[t]&&(o[t]=n[t].slice(0))}return o};var D=function(e,t){e=e.toLowerCase().replace(/^on/,"");var o=t&&t.flashVersion&&u(t.flashVersion)||null,n=g,r=!0;switch(e){case"load":if(o){if(!p(o))return void D.call(this,"onWrongFlash",{flashVersion:o});y.wrongflash=!1,y.ready=!0,y.version=o}break;case"wrongflash":o&&!p(o)&&(y.wrongflash=!0,y.ready=!1,y.version=o);break;case"mouseover":h(n,M.hoverClass);break;case"mouseout":I.deactivate();break;case"mousedown":h(n,M.activeClass);break;case"mouseup":f(n,M.activeClass);break;case"datarequested":var i,a=n.getAttribute("data-clipboard-target"),a=a?document.getElementById(a):null;a?(i=a.value||a.textContent||a.innerText)&&this.setText(i):(i=n.getAttribute("data-clipboard-text"))&&this.setText(i),r=!1;break;case"complete":!function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&delete e[t]}(v)}var s=P[this.id]&&P[this.id].handlers[e];if(s&&s.length)for(var l,c=0,d=s.length;c<d;c++)"string"==typeof(l=s[c])&&"function"==typeof window[l]&&(l=window[l]),"function"==typeof l&&function(e,t,o,n){r?window.setTimeout(function(){e.call(t,o,n)},0):e.call(t,o,n)}(l,n,this,t)};I.prototype.glue=function(e){e=m(e);for(var t,o,n,r=0;r<e.length;r++)e.hasOwnProperty(r)&&e[r]&&1===e[r].nodeType&&(e[r].zcClippingId?-1===d(this.id,b[e[r].zcClippingId])&&b[e[r].zcClippingId].push(this.id):(e[r].zcClippingId="zcClippingId_"+k++,b[e[r].zcClippingId]=[this.id],t=e[r],o="mouseover",n=c,t&&1===t.nodeType&&(t.addEventListener?t.addEventListener(o,n,!1):t.attachEvent&&t.attachEvent("on"+o,n))),n=P[this.id].elements,-1===d(e[r],n)&&n.push(e[r]));return this},I.prototype.unglue=function(e){var t,o,n,r=P[this.id];if(r){void 0===e&&(e=r.elements.slice(0)),e=m(e);for(var i=0;i<e.length;i++)if(e.hasOwnProperty(i)&&e[i]&&1===e[i].nodeType){for(var a=r.elements,s=0;-1!==(s=d(e[i],a,s));)a.splice(s,1);var l=b[e[i].zcClippingId];if(l){for(s=0;-1!==(s=d(this.id,l,s));)l.splice(s,1);0===l.length&&(t=e[i],o="mouseover",n=c,t&&1===t.nodeType&&(t.removeEventListener?t.removeEventListener(o,n,!1):t.detachEvent&&t.detachEvent("on"+o,n)),delete e[i].zcClippingId)}}}return this},I.prototype.elements=function(){var e=P[this.id];return e&&e.elements?e.elements.slice(0):[]};var N=function(e){var t,o,n,r,i,a=[];if(e&&1===e.nodeType&&(t=e.zcClippingId)&&b.hasOwnProperty(t)&&((o=b[t])&&o.length))for(n=0,r=o.length;n<r;n++)(i=P[o[n]].instance)&&i instanceof I&&a.push(i);return a};M.hoverClass="zeroclipboard-is-hover",M.activeClass="zeroclipboard-is-active",M.trustedOrigins=null,M.allowScriptAccess=null,I.detectFlashSupport=function(){var e=M.debug;return n("ZeroClipboard.detectFlashSupport",e),i()},I.prototype.setHandCursor=function(e){return n("ZeroClipboard.prototype.setHandCursor",M.debug),$(e="boolean"==typeof e?e:!!e),M.forceHandCursor=e,this},I.prototype.reposition=function(){return n("ZeroClipboard.prototype.reposition",M.debug),R()},I.prototype.receiveEvent=function(e,t){var o;n("ZeroClipboard.prototype.receiveEvent",M.debug),"string"==typeof e&&e&&(o=e.toLowerCase().replace(/^on/,""))&&D.call(this,o,t)},I.prototype.setCurrent=function(e){return n("ZeroClipboard.prototype.setCurrent",M.debug),I.activate(e),this},I.prototype.resetBridge=function(){return n("ZeroClipboard.prototype.resetBridge",M.debug),I.deactivate(),this},I.prototype.setTitle=function(e){var t;return n("ZeroClipboard.prototype.setTitle",M.debug),(e=e||M.title||g&&g.getAttribute("title"))&&(t=E(y.bridge))&&t.setAttribute("title",e),this},I.setDefaults=function(e){n("ZeroClipboard.setDefaults",M.debug),I.config(e)},I.prototype.addEventListener=function(){return n("ZeroClipboard.prototype.addEventListener",M.debug),this.on.apply(this,[].slice.call(arguments,0))},I.prototype.removeEventListener=function(){return n("ZeroClipboard.prototype.removeEventListener",M.debug),this.off.apply(this,[].slice.call(arguments,0))},I.prototype.ready=function(){return n("ZeroClipboard.prototype.ready",M.debug),!0===y.ready},"function"==typeof define&&define.amd?define(["require","exports","module"],function(e,t,o){return x=o&&o.id||null,I}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?(U=module.id||null,module.exports=I):window.ZeroClipboard=I}();var TeamPoker=TeamPoker||{};function SocketClient(e){this.ServerUrl=e}function WidgetBase(){this.base=WidgetBase.prototype,this.onShown=[],this.onHidden=[],this.WidgetDOM=null,this.ListenerQueue={},this.broadcastMessage=function(e,t){this.ListenerQueue[e]&&this.ListenerQueue[e].forEach(function(e){e(t)})}}function PopUp(n,r,i,a,s,l){TeamPoker.UI.WidgetBase.call(this);var e=this,c=null;this.init=function(){s=s||"modal fade",l=l||"static",c=$("<div>").attr("id",n).attr("class",s);function e(o,e){$.isArray(e)?$.each(e,function(e,t){o.append(t)}):o.append(e)}var t=$("<div>").attr("class","modal-dialog"),o=$("<div>").attr("class","modal-content");e(o,[$("<div>").attr("class","modal-header").append(r),$("<div>").attr("class","modal-body").append(i),$("<div>").attr("class","modal-footer").append(a)]),e(t,o),c.append(t),this.WidgetDOM=c,this.base.init.call(this)},this.show=function(){this.WidgetDOM.modal({backdrop:l,keyboard:!1,show:!0}),this.WidgetDOM.on("show.bs.modal",function(){e.onShow.length&&e.onShow.forEach(function(e){e()})}),this.WidgetDOM.on("shown.bs.modal",function(){e.onShown.length&&e.onShown.forEach(function(e){e()})}),this.WidgetDOM.on("hide.bs.modal",function(){e.onHide.length&&e.onHide.forEach(function(e){e()})}),this.WidgetDOM.on("hidden.bs.modal",function(){$(this).remove(),e.onHidden.length&&e.onHidden.forEach(function(e){e()})})},this.hide=function(){this.WidgetDOM.modal("hide")},this.onShow=[],this.onShown=[],this.onHide=[],this.onHidden=[]}function ShareLinkPopup(){TeamPoker.UI.WidgetBase.call(this);var i=null;this.init=function(){var e=$("<h3>").text("Copy the room link below and share to teammates"),t=$("<label>").attr("class","control-label").attr("for","txt-room-link").text("Room Link"),o=$("<input>").attr("type","text").attr("class","form-control").attr("readonly","readonly").attr("id","txt-room-link").val(location.href),n=$("<a>").attr("class","btn btn-primary").attr("id","btn-copy").attr("data-clipboard-target","txt-room-link").text("Copy"),r=$("<div>").attr("id","share-link").append(t).append(o).append(n),t=$("<a>").attr("href","javascript:void(0);").attr("data-dismiss","modal").attr("class","btn btn-primary").text("Dismiss");(i=new TeamPoker.UI.PopUp("shareLinkPopup",e,r,t)).onShown.push(function(){o.select()}),o.click(function(){$(this).select()}),i.init(),ZeroClipboard.config({moviePath:"javascripts/vendor/ZeroClipboard.swf"});n=document.getElementById("btn-copy");return new ZeroClipboard(n).glue(n),this},this.show=function(){i.show()},this.hide=function(){i.hide()}}function LoginForm(){TeamPoker.UI.WidgetBase.call(this);var r=null;this.init=function(){var e=$("<h3>").text("Welcome to room: "+location.href.substring(location.href.lastIndexOf("/")+1)+"! Please input your name"),o=$("<input>").attr("type","text").attr("class","form-control").attr("placeholder","Input your name here").attr("autofocus","").attr("id","txt-nickname"),t=$("<form>").attr("class","form-horizontal").attr("role","form").attr("id","form-nickname").append($("<div>").attr("class","form-group").append($("<label>").attr("class","control-label col-sm-3").attr("for","txt-nickname").text("Nick Name")).append($("<div>").attr("class","col-sm-8").append(o))),n=$("<a>").attr("href","javascript:void(0);").attr("class","btn btn-primary").text("Join this room!");(r=new TeamPoker.UI.PopUp("loginForm",e,t,n)).onShown.push(function(){o.focus();var e=$("#form-nickname");e.on("submit",function(e){e.preventDefault()}),o.blur(function(){$.trim($(this).val())?(e.removeClass("has-error"),e.addClass("has-success")):(e.removeClass("has-success"),e.addClass("has-error"))})}),n.click(function(e){var t=$.trim(o.val());t&&(TeamPoker.login(t),r.hide())}),r.init(),r.WidgetDOM.keydown(function(e){13==e.keyCode&&n.click()})},this.show=function(){r.show()},this.hide=function(){r.hide()}}function PokerQueue(){TeamPoker.UI.WidgetBase.call(this),this.voteStatus=$("#pokerbar-wrapper #vote-status"),this.init=function(){var o=$("<div>").attr("id","pokerbar"),n=$("#pokerbar-wrapper #vote-status #spVoteVal"),r=this;TeamPoker.Constants.POKER_VALUES.forEach(function(e){e=$("<div>").attr("class","poker").attr("title",e).attr("vote-value",e).text(e).css("margin-left","-18px");e.hover(function(){$(this).addClass("activePoker"),$(this).css("z-index",100)},function(){$(this).removeClass("activePoker"),$(this).css("z-index",0)}),e.click(function(e){$(this).tooltip("hide");var t=$(this).attr("vote-value");o.hide(),n.text(t),r.voteStatus.show(),r.broadcastMessage("USER-VOTE",t)}),o.append(e)}),this.WidgetDOM=o,this.base.init.call(this,$("#pokerbar-wrapper"))},this.show=function(){this.base.show.call(this),this.voteStatus.hide(),$("#pokerbar > .poker").tooltip({})}}function ParticipantList(){TeamPoker.UI.WidgetBase.call(this);var o=this;this.ParticipantsList=$("#participants"),this.init=function(e){o.ParticipantsList.html(""),_(e).each(function(e,t){o.addParticipant(t,e)}),this.WidgetDOM=this.ParticipantsList},this.show=function(){},this.addParticipant=function(e,t){t=$("<span>").attr("class","participant").attr("id",e).text(t);this.ParticipantsList.append(t)},this.removeFromParticipantsList=function(e){this.ParticipantsList.find("span[id="+e+"]").remove()},this.updateVoteStatus=function(e){this.ParticipantsList.find(".participant[id="+e+"]").addClass("voted")},this.resetVoteStatus=function(e){this.ParticipantsList.find(".participant").removeClass("voted")}}function VoteResultDialog(l,c){TeamPoker.UI.WidgetBase.call(this);var d=null;this.init=function(){var e=[$("<h3>").text("Voting results for Story: "),$("<span>").text(l)],r=$("<div>").attr("id","voteResultPanel"),o=$("<input>").attr("type","text").attr("class","input-mini").attr("id","txt-estimated-story-point").attr("size","2").attr("autofocus",""),n=$("<span>").attr("class","hide ipt-err").text("Invalid story point!"),t=$("<div>").attr("id","estimated-story-point-wrapper").append($("<strong>").append($("<span>").text("Let's decide the point: "))).append(o).append(n),i=$("<a>").attr("href","javascript:void(0);").attr("class","btn btn-default").attr("data-dismiss","modal").text("Re-vote"),a=$("<a>").attr("href","javascript:void(0);").attr("class","btn btn-success").text("Save Point To Story"),t=[t,i,a],s=this;(d=new TeamPoker.UI.PopUp("vote-result-dialog",e,r,t)).init(),d.onShown.push(function(){var n=[];_(c).each(function(e){var t=e.VoterName,o=e.VoteVal,t=$('<div class="votedPoker resultPoker"><div class="poker">'+o+"</div><span>"+t+"</span></div>");t.bind("transitionend webkitTransitionEnd",function(){e.HighScore&&($(this).addClass("highscore"),$(this).css("margin-top","10px")),e.LowScore&&($(this).addClass("lowscore"),$(this).css("margin-top","30px")),e.SpecialScore&&$(this).addClass("specialscore")}),r.append(t),n.push(t)}),_(n).each(function(t){setTimeout(function(){var e;(e=t).css("opacity",1),e.css("webkitTransform","rotateY(360deg)"),e.css("-moz-Transform","rotateY(360deg)")},100)})}),o.blur(function(){-1===$.inArray($(this).val(),TeamPoker.Constants.POKER_VALUES)?n.removeClass("hide"):n.addClass("hide")}),i.click(function(e){s.broadcastMessage("RE-VOTE")}),a.click(function(e){var t=$.trim(o.val());""!==t&&0<=$.inArray(t,TeamPoker.Constants.POKER_VALUES)?(s.broadcastMessage("SAVE-POINT",t),d.hide()):n.removeClass("hide")})},this.show=function(){d.show()},this.hide=function(){d.hide()}}TeamPoker.UI=TeamPoker.UI||{},"localStorage"in window&&null!==window.localStorage&&(Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){return this.getItem(e)&&JSON.parse(this.getItem(e))}),TeamPoker.Constants={POKER_VALUES:["0","0.5","1","2","3","5","8","13","20","40","100","?"]},SocketClient.prototype={Listeners:{},ServerUrl:"",connect:function(){this.socket=io.connect(this.ServerUrl,{"sync disconnect on unload":!1});var e=this,t=location.pathname.substring(1);console.log('Connected to Socket server, namespace: "'+t+'".'),this.socket.on(t,function(t){console.log("Client received message: "),console.log(t),e.Listeners[t.MsgType]&&e.Listeners[t.MsgType].length&&_(e.Listeners[t.MsgType]).each(function(e){e(t.Data)})})},sendMsg:function(e,t){this.socket.emit(e,t)},addListener:function(e,t){this.Listeners[e]=this.Listeners[e]||[],this.Listeners[e].push(t)}},TeamPoker.SocketClient=new SocketClient([location.protocol,"//",location.host].join("")),TeamPoker.SocketClient.connect(),WidgetBase.prototype={constructor:WidgetBase,init:function(e){e=e||$(document.body),this.WidgetDOM&&e.append(this.WidgetDOM)},show:function(){if(!this.WidgetDOM)throw new Error("Cannot show this widget without seting WidgetDOM!");this.WidgetDOM.show(),this.onShown.length&&this.onShown.forEach(function(e){e()})},hide:function(){if(!this.WidgetDOM)throw new Error("Cannot show this widget without seting WidgetDOM!");this.WidgetDOM.hide(),this.onHidden.length&&this.onHidden.forEach(function(e){e()})}},TeamPoker.UI.WidgetBase=WidgetBase,PopUp.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.PopUp=PopUp,ShareLinkPopup.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.ShareLinkPopup=ShareLinkPopup,LoginForm.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.LoginForm=LoginForm,PokerQueue.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.PokerQueue=PokerQueue,ParticipantList.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.ParticipantList=ParticipantList,TeamPoker.UIManager={ParticipantsList:null,StoryPointer:null,PokerQueue:null,VoteResultDialog:null,IsCreatingRoom:"/"===location.pathname,init:function(){var e;$("#btn-logout").click(function(e){e.preventDefault(),TeamPoker.logout(),location.reload()}),$.cookie("LoginName")?TeamPoker.login($.cookie("LoginName")):((e=new TeamPoker.UI.LoginForm).init(),e.show()),$("#btnViewResult").click(TeamPoker.viewVoteResult),this.ParticipantList=new TeamPoker.UI.ParticipantList,this.PokerQueue=new TeamPoker.UI.PokerQueue,this.PokerQueue.init(),this.PokerQueue.ListenerQueue["USER-VOTE"]=[function(e){TeamPoker.vote(e)}],this.PokerQueue.show()},loadRoomInfo:function(e){$("#txt-room-link").val(location.href);var t=new ZeroClipboard($("#btn-copy"),{moviePath:"javascripts/vendor/ZeroClipboard.swf"});$(t.htmlBridge).tooltip({title:"Copy Room Link!",placement:"bottom"}),this.initStoryTable(e),this.ParticipantList.init(e.ParticipantCollection)},newParticipant:function(e,t){this.ParticipantList.addParticipant(e,t)},leaveParticipant:function(e){this.ParticipantList.removeFromParticipantsList(e)},initStoryTable:function(e){_(e.StoryCollection).each(function(e,t){TeamPoker.UIManager.addStoryRow({Id:t,Title:e.Title,Point:e.Point})}),e.CurrentVotingStory?(TeamPoker.CurrentVotingStory=e.CurrentVotingStory,this.setStoryPointer(e.CurrentVotingStory)):this.setStoryPointer(parseInt($("#story-table > tbody > tr:first").attr("story-id"))),$("#btn-add-story").click(function(){TeamPoker.UIManager.addStoryRow()})},setStoryPointer:function(e){TeamPoker.CurrentVotingStory=e,this.StoryPointer&&this.StoryPointer.remove();var t=$("<span>").attr("id","pointer").attr("class","glyphicon glyphicon-circle-arrow-left").attr("draggable","true");t.tooltip({title:"Drag to change story",placement:"right",delay:{show:200,hide:0}}),t[0].addEventListener("dragstart",function(e){e.dataTransfer.effectAllowed="move"}),this.StoryPointer=t,$("#story-table > tbody > tr[story-id="+e+"] > td:eq(2)").append(t),this.PokerQueue.show(),this.ParticipantList.resetVoteStatus()},addStoryRow:function(e){var t=document.getElementById("story-table").tBodies[0],o=t.insertRow(0),n=$(o.insertCell(0)),r=$(o.insertCell(1));$(o.insertCell(2));e?(n.html(e.Title),e.Point&&r.html(e.Point),$(o).attr("story-id",e.Id)):(r=$("#story-table > tbody > tr:last").attr("story-id")||0,$(o).attr("story-id",parseInt(r)+1),0===r&&this.setStoryPointer($(o.cells[2]))),t.appendChild(o),this.bindEventForStoryRow(o),e||$(o.cells[0]).click()},bindEventForStoryRow:function(e){$([e.cells[0],e.cells[1]]).on("click",TeamPoker.UIManager.changeStoryContent),this.makeCellDraggable(e.cells[2])},makeCellDraggable:function(e){e.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",$(this).addClass("dragover")}),e.addEventListener("dragleave",function(e){$(this).removeClass("dragover")}),e.addEventListener("drop",function(e){$(this).removeClass("dragover"),$(this).append(TeamPoker.UIManager.StoryPointer),TeamPoker.setCurrentStory(parseInt($(this).parent().attr("story-id"))),TeamPoker.UIManager.ParticipantList.resetVoteStatus(),TeamPoker.UIManager.PokerQueue.show()})},changeStoryContent:function(e){var o=$(this),n=parseInt($(this).parent().attr("story-id")),r=$(this).html(),t=$("<input>").attr("type","text").val($(this).text());o.off("click"),t.on("blur",function(e){var t=$(this).val();t!==r&&(0===this.parentElement.cellIndex?TeamPoker.updateStoryInfo(n,{Title:t}):1===this.parentElement.cellIndex&&TeamPoker.updateStoryInfo(n,{Point:t})),o.html($(this).val()),o.on("click",TeamPoker.UIManager.changeStoryContent)}),o.html(""),o.append(t),t.focus()},updateStoryInfo:function(e){$("#story-table > tbody > tr[story-id="+e.Id+"]").length?"Title"in e.Val?$("#story-table > tbody > tr[story-id="+e.Id+"] > td:eq(0)").html(e.Val.Title):"Point"in e.Val&&$("#story-table > tbody > tr[story-id="+e.Id+"] > td:eq(1)").html(e.Val.Point):this.addStoryRow({Id:e.Id,Title:e.Val.Title,Point:e.Val.Point})},onUserVote:function(e){TeamPoker.UIManager.ParticipantList.updateVoteStatus(e)},displayVoteResult:function(e){console.log("Displaying vote result: "),console.log(e);var t=$("#story-table > tbody > tr[story-id="+TeamPoker.CurrentVotingStory+"] > td:eq(0)").html();this.VoteResultDialog=new TeamPoker.UI.VoteResultDialog(t,e),this.VoteResultDialog.init(),this.VoteResultDialog.ListenerQueue["RE-VOTE"]=[function(){TeamPoker.UIManager.updateStoryInfo({Id:TeamPoker.CurrentVotingStory,Val:{Point:""}}),TeamPoker.UIManager.PokerQueue.show(),TeamPoker.UIManager.ParticipantList.resetVoteStatus(),TeamPoker.reVote()}],this.VoteResultDialog.ListenerQueue["SAVE-POINT"]=[function(e){TeamPoker.UIManager.updateStoryInfo({Id:TeamPoker.CurrentVotingStory,Val:{Point:e}}),TeamPoker.UIManager.PokerQueue.show(),TeamPoker.savePoint(e)}],this.VoteResultDialog.show()},revoteForStory:function(e){this.updateStoryInfo({Id:e,Val:{Point:""}}),this.PokerQueue.show(),this.VoteResultDialog&&this.VoteResultDialog.hide(),this.ParticipantList.resetVoteStatus()},savePointForStory:function(e,t){this.updateStoryInfo({Id:e,Val:{Point:t}}),this.PokerQueue.show(),this.VoteResultDialog&&this.VoteResultDialog.hide(),this.ParticipantList.resetVoteStatus()},cleanUp:function(){sessionStorage.clear()}},$(document).ready(function(){TeamPoker.UIManager.init()}),$(window).on("beforeunload",function(){return"You are about to leave Team Poker..."}),$(window).unload(function(){TeamPoker.logout(),TeamPoker.UIManager.cleanUp()}),VoteResultDialog.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.VoteResultDialog=VoteResultDialog,TeamPoker.CurrentVoterName="",TeamPoker.CurrentVoterId=0,TeamPoker.CurrentVotingStory=0,TeamPoker.MessageType={LoginCallback:"LoginCallback",NewParticipant:"NewParticipant",LeaveParticipant:"LeaveParticipant",ParticipantVoted:"ParticipantVoted",SetCurrentStory:"SetCurrentStory",UpdateStoryInfo:"UpdateStoryInfo",ViewVoteResult:"ViewVoteResult",Revote:"Revote",SavePoint:"SavePoint",GameStatus:"GameStatus"},TeamPoker.login=function(e){TeamPoker.SocketClient.sendMsg("login_event",e)},TeamPoker.loginCallback=function(e){"true"===e.Success?(TeamPoker.CurrentVoterId=e.ParticipantInfo.Id,TeamPoker.CurrentVoterName=e.ParticipantInfo.Name,TeamPoker.UIManager.loadRoomInfo(e.RoomInfo),sessionStorage.setObject("RoomInfo",e.RoomInfo)):alert("Oops! Some error occured result in Login attempt failed! Please try again:)")},TeamPoker.logout=function(){$.removeCookie("LoginName"),TeamPoker.SocketClient.sendMsg("logout_event",TeamPoker.CurrentVoterId)},TeamPoker.newParticipantCallback=function(e){TeamPoker.UIManager.newParticipant(e.Id,e.Name)},TeamPoker.leaveParticipantCallback=function(e){TeamPoker.UIManager.leaveParticipant(e.Id)},TeamPoker.setCurrentStory=function(e){TeamPoker.CurrentVotingStory=e,TeamPoker.SocketClient.sendMsg("set_current_story_event",e)},TeamPoker.setCurrentStoryCallback=function(e){TeamPoker.UIManager.setStoryPointer(e.StoryId)},TeamPoker.updateStoryInfo=function(e,t){TeamPoker.SocketClient.sendMsg("update_story_event",{Id:e,Val:t})},TeamPoker.updateStoryInfoCallback=function(e){TeamPoker.UIManager.updateStoryInfo(e.StoryInfo)},TeamPoker.vote=function(e){TeamPoker.SocketClient.sendMsg("vote_event",{StoryId:TeamPoker.CurrentVotingStory,VoterId:TeamPoker.CurrentVoterId,VoterName:TeamPoker.CurrentVoterName,VoteVal:e})},TeamPoker.voteCallback=function(e){TeamPoker.UIManager.onUserVote(e.VoterId)},TeamPoker.viewVoteResult=function(e){TeamPoker.SocketClient.sendMsg("view_vote_result_event",TeamPoker.CurrentVotingStory)},TeamPoker.viewVoteResultCallback=function(e){_(e.VoteStatus).each(function(e){"?"===e.VoteVal||"0"===e.VoteVal?e.SpecialScore=!0:e.VoteVal=parseFloat(e.VoteVal)});var t=_.chain(e.VoteStatus).pluck("VoteVal").without("?","0").sort(function(e,t){return e-t}).uniq();2<t.value().length&&_(e.VoteStatus).each(function(e){e.VoteVal===t.first().value()&&(e.LowScore=!0),e.VoteVal===t.last().value()&&(e.HighScore=!0)}),TeamPoker.UIManager.displayVoteResult(e.VoteStatus)},TeamPoker.reVote=function(){TeamPoker.SocketClient.sendMsg("revote_event",TeamPoker.CurrentVotingStory)},TeamPoker.reVoteCallback=function(e){TeamPoker.UIManager.revoteForStory(e.Id)},TeamPoker.savePoint=function(e){TeamPoker.SocketClient.sendMsg("save_point_event",{Id:TeamPoker.CurrentVotingStory,Point:e})},TeamPoker.savePointCallback=function(e){TeamPoker.UIManager.savePointForStory(e.Id,e.Point)},TeamPoker.SocketClient.addListener(TeamPoker.MessageType.LoginCallback,TeamPoker.loginCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.GameStatus,TeamPoker.onLoadGameStatus),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.NewParticipant,TeamPoker.newParticipantCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.LeaveParticipant,TeamPoker.leaveParticipantCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.ParticipantVoted,TeamPoker.voteCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.SetCurrentStory,TeamPoker.setCurrentStoryCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.UpdateStoryInfo,TeamPoker.updateStoryInfoCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.ViewVoteResult,TeamPoker.viewVoteResultCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.Revote,TeamPoker.reVoteCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.SavePoint,TeamPoker.savePointCallback);