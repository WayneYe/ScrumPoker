/* Scrum Team Poker - A realtime web application powered by node/express and Socket.IO.
* version 2.0.0 - 2014-02-23
* Copyright (c) 2011 - 2014 Wayne Ye - http://wayneye.com
* Licensed with MIT */
function SocketClient(a){this.ServerUrl=a}function WidgetBase(){this.base=WidgetBase.prototype,this.onShown=[],this.onHidden=[],this.WidgetDOM=null,this.ListenerQueue={},this.broadcastMessage=function(a,b){this.ListenerQueue[a]&&this.ListenerQueue[a].forEach(function(a){a(b)})}}function PopUp(a,b,c,d,e,f){TeamPoker.UI.WidgetBase.call(this);var g=this,h=null;this.init=function(){e=e||"modal fade",f=f||"static",h=$("<div>").attr("id",a).attr("class",e);var g=function(a,b){$.isArray(b)?$.each(b,function(b,c){a.append(c)}):a.append(b)},i=$("<div>").attr("class","modal-dialog"),j=$("<div>").attr("class","modal-content"),k=$("<div>").attr("class","modal-header").append(b),l=$("<div>").attr("class","modal-body").append(c),m=$("<div>").attr("class","modal-footer").append(d);g(j,[k,l,m]),g(i,j),h.append(i),this.WidgetDOM=h,this.base.init.call(this)},this.show=function(){this.WidgetDOM.modal({backdrop:f,keyboard:!1,show:!0}),this.WidgetDOM.on("show.bs.modal",function(){g.onShow.length&&g.onShow.forEach(function(a){a()})}),this.WidgetDOM.on("shown.bs.modal",function(){g.onShown.length&&g.onShown.forEach(function(a){a()})}),this.WidgetDOM.on("hide.bs.modal",function(){g.onHide.length&&g.onHide.forEach(function(a){a()})}),this.WidgetDOM.on("hidden.bs.modal",function(){$(this).remove(),g.onHidden.length&&g.onHidden.forEach(function(a){a()})})},this.hide=function(){this.WidgetDOM.modal("hide")},this.onShow=[],this.onShown=[],this.onHide=[],this.onHidden=[]}function ShareLinkPopup(){TeamPoker.UI.WidgetBase.call(this);var a=null;this.init=function(){var b=$("<h3>").text("Copy the room link below and share to teammates"),c=$("<label>").attr("class","control-label").attr("for","txt-room-link").text("Room Link"),d=$("<input>").attr("type","text").attr("class","form-control").attr("readonly","readonly").attr("id","txt-room-link").val(location.href),e=$("<a>").attr("class","btn btn-primary").attr("id","btn-copy").attr("data-clipboard-target","txt-room-link").text("Copy"),f=$("<div>").attr("id","share-link").append(c).append(d).append(e),g=$("<a>").attr("href","javascript:void(0);").attr("data-dismiss","modal").attr("class","btn btn-primary").text("Dismiss");a=new TeamPoker.UI.PopUp("shareLinkPopup",b,f,g),a.onShown.push(function(){d.select()}),d.click(function(){$(this).select()}),a.init(),ZeroClipboard.config({moviePath:"javascripts/vendor/ZeroClipboard.swf"});var e=document.getElementById("btn-copy"),h=new ZeroClipboard(e);return h.glue(e),this},this.show=function(){a.show()},this.hide=function(){a.hide()}}function LoginForm(){TeamPoker.UI.WidgetBase.call(this);var a=null;this.init=function(){var b=$("<h3>").text("Welcome to room: "+location.href.substring(location.href.lastIndexOf("/")+1)+"! Please input your name"),c=$("<input>").attr("type","text").attr("class","form-control").attr("placeholder","Input your name here").attr("autofocus","").attr("id","txt-nickname"),d=$("<form>").attr("class","form-horizontal").attr("role","form").attr("id","form-nickname").append($("<div>").attr("class","form-group").append($("<label>").attr("class","control-label col-sm-3").attr("for","txt-nickname").text("Nick Name")).append($("<div>").attr("class","col-sm-8").append(c))),e=$("<a>").attr("href","javascript:void(0);").attr("class","btn btn-primary").text("Join this room!");a=new TeamPoker.UI.PopUp("loginForm",b,d,e),a.onShown.push(function(){c.focus();var a=$("#form-nickname");a.on("submit",function(a){a.preventDefault()}),c.blur(function(){$.trim($(this).val())?(a.removeClass("has-error"),a.addClass("has-success")):(a.removeClass("has-success"),a.addClass("has-error"))})}),e.click(function(){var b=$.trim(c.val());b&&(TeamPoker.login(b),a.hide())}),a.init(),a.WidgetDOM.keydown(function(a){13==a.keyCode&&e.click()})},this.show=function(){a.show()},this.hide=function(){a.hide()}}function PokerQueue(){TeamPoker.UI.WidgetBase.call(this),this.voteStatus=$("#pokerbar-wrapper #vote-status"),this.init=function(){var a=$("<div>").attr("id","pokerbar"),b=$("#pokerbar-wrapper #vote-status #spVoteVal"),c=this;TeamPoker.Constants.POKER_VALUES.forEach(function(d){var e=$("<div>").attr("class","poker").attr("title",d).attr("vote-value",d).text(d).css("margin-left","-18px");e.hover(function(){$(this).addClass("activePoker"),$(this).css("z-index",100)},function(){$(this).removeClass("activePoker"),$(this).css("z-index",0)}),e.click(function(){$(this).tooltip("hide");var d=$(this).attr("vote-value");a.hide(),b.text(d),c.voteStatus.show(),c.broadcastMessage("USER-VOTE",d)}),a.append(e)}),this.WidgetDOM=a,this.base.init.call(this,$("#pokerbar-wrapper"))},this.show=function(){this.base.show.call(this),this.voteStatus.hide(),$("#pokerbar > .poker").tooltip({})}}function ParticipantList(){TeamPoker.UI.WidgetBase.call(this);var a=this;this.ParticipantsList=$("#participants"),this.init=function(b){a.ParticipantsList.html(""),_(b).each(function(b,c){a.addParticipant(c,b)}),this.WidgetDOM=this.ParticipantsList},this.show=function(){},this.addParticipant=function(a,b){var c=$("<span>").attr("class","participant").attr("id",a).text(b);this.ParticipantsList.append(c)},this.removeFromParticipantsList=function(a){this.ParticipantsList.find("span[id="+a+"]").remove()},this.updateVoteStatus=function(a){this.ParticipantsList.find(".participant[id="+a+"]").addClass("voted")},this.resetVoteStatus=function(){this.ParticipantsList.find(".participant").removeClass("voted")}}function VoteResultDialog(a,b){TeamPoker.UI.WidgetBase.call(this);var c=null;this.init=function(){var d=[$("<h3>").text("Voting results for Story: "),$("<span>").text(a)],e=$("<div>").attr("id","voteResultPanel"),f=$("<input>").attr("type","text").attr("class","input-mini").attr("id","txt-estimated-story-point").attr("size","2").attr("autofocus",""),g=$("<span>").attr("class","hide ipt-err").text("Invalid story point!"),h=$("<div>").attr("id","estimated-story-point-wrapper").append($("<strong>").append($("<span>").text("Let's decide the point: "))).append(f).append(g),i=$("<a>").attr("href","javascript:void(0);").attr("class","btn btn-default").attr("data-dismiss","modal").text("Re-vote"),j=$("<a>").attr("href","javascript:void(0);").attr("class","btn btn-success").text("Save Point To Story"),k=[h,i,j],l=this;c=new TeamPoker.UI.PopUp("vote-result-dialog",d,e,k),c.init(),c.onShown.push(function(){var a=function(a){a.css("opacity",1),a.css("webkitTransform","rotateY(360deg)"),a.css("-moz-Transform","rotateY(360deg)")},c=[];_(b).each(function(a){var b=a.VoterName,d=a.VoteVal,f=$('<div class="votedPoker resultPoker"><div class="poker">'+d+"</div><span>"+b+"</span></div>");f.bind("transitionend webkitTransitionEnd",function(){a.HighScore&&($(this).addClass("highscore"),$(this).css("margin-top","10px")),a.LowScore&&($(this).addClass("lowscore"),$(this).css("margin-top","30px")),a.SpecialScore&&$(this).addClass("specialscore")}),e.append(f),c.push(f)}),_(c).each(function(b){setTimeout(function(){a(b)},100)})}),f.blur(function(){-1===$.inArray($(this).val(),TeamPoker.Constants.POKER_VALUES)?g.removeClass("hide"):g.addClass("hide")}),i.click(function(){l.broadcastMessage("RE-VOTE")}),j.click(function(){var a=$.trim(f.val());""!==a&&$.inArray(a,TeamPoker.Constants.POKER_VALUES)>=0?(l.broadcastMessage("SAVE-POINT",a),c.hide()):g.removeClass("hide")})},this.show=function(){c.show()},this.hide=function(){c.hide()}}!function(){"use strict";function a(a){return a.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function b(b){return parseFloat(a(b))>=10}var c,d={bridge:null,version:"0.0.0",noflash:null,wrongflash:null,ready:null},e={},f=0,g={},h=0,i={},j=function(){var a=/\-([a-z])/g,b=function(a,b){return b.toUpperCase()};return function(c){return c.replace(a,b)}}(),k=function(a,b){var c,d,e;return window.getComputedStyle?c=window.getComputedStyle(a,null).getPropertyValue(b):(d=j(b),c=a.currentStyle?a.currentStyle[d]:a.style[d]),"cursor"!==b||c&&"auto"!==c||(e=a.tagName.toLowerCase(),"a"!==e)?c:"pointer"},l=function(a){a||(a=window.event);var b;this!==window?b=this:a.target?b=a.target:a.srcElement&&(b=a.srcElement),F.activate(b)},m=function(a,b,c){a&&1===a.nodeType&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))},n=function(a,b,c){a&&1===a.nodeType&&(a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c))},o=function(a,b){if(!a||1!==a.nodeType)return a;if(a.classList)return a.classList.contains(b)||a.classList.add(b),a;if(b&&"string"==typeof b){var c=(b||"").split(/\s+/);if(1===a.nodeType)if(a.className){for(var d=" "+a.className+" ",e=a.className,f=0,g=c.length;g>f;f++)d.indexOf(" "+c[f]+" ")<0&&(e+=" "+c[f]);a.className=e.replace(/^\s+|\s+$/g,"")}else a.className=b}return a},p=function(a,b){if(!a||1!==a.nodeType)return a;if(a.classList)return a.classList.contains(b)&&a.classList.remove(b),a;if(b&&"string"==typeof b||void 0===b){var c=(b||"").split(/\s+/);if(1===a.nodeType&&a.className)if(b){for(var d=(" "+a.className+" ").replace(/[\n\t]/g," "),e=0,f=c.length;f>e;e++)d=d.replace(" "+c[e]+" "," ");a.className=d.replace(/^\s+|\s+$/g,"")}else a.className=""}return a},q=function(){var a,b,c,d=1;return"function"==typeof document.body.getBoundingClientRect&&(a=document.body.getBoundingClientRect(),b=a.right-a.left,c=document.body.offsetWidth,d=Math.round(b/c*100)/100),d},r=function(a,b){var c={left:0,top:0,width:0,height:0,zIndex:x(b)-1};if(a.getBoundingClientRect){var d,e,f,g=a.getBoundingClientRect();"pageXOffset"in window&&"pageYOffset"in window?(d=window.pageXOffset,e=window.pageYOffset):(f=q(),d=Math.round(document.documentElement.scrollLeft/f),e=Math.round(document.documentElement.scrollTop/f));var h=document.documentElement.clientLeft||0,i=document.documentElement.clientTop||0;c.left=g.left+d-h,c.top=g.top+e-i,c.width="width"in g?g.width:g.right-g.left,c.height="height"in g?g.height:g.bottom-g.top}return c},s=function(a,b){var c=!(b&&b.useNoCache===!1);return c?(-1===a.indexOf("?")?"?":"&")+"nocache="+(new Date).getTime():""},t=function(a){var b,c,d,e=[],f=[],g=[];if(a.trustedOrigins&&("string"==typeof a.trustedOrigins?f.push(a.trustedOrigins):"object"==typeof a.trustedOrigins&&"length"in a.trustedOrigins&&(f=f.concat(a.trustedOrigins))),a.trustedDomains&&("string"==typeof a.trustedDomains?f.push(a.trustedDomains):"object"==typeof a.trustedDomains&&"length"in a.trustedDomains&&(f=f.concat(a.trustedDomains))),f.length)for(b=0,c=f.length;c>b;b++)if(f.hasOwnProperty(b)&&f[b]&&"string"==typeof f[b]){if(d=A(f[b]),!d)continue;if("*"===d){g=[d];break}g.push.apply(g,[d,"//"+d,window.location.protocol+"//"+d])}return g.length&&e.push("trustedOrigins="+encodeURIComponent(g.join(","))),"string"==typeof a.amdModuleId&&a.amdModuleId&&e.push("amdModuleId="+encodeURIComponent(a.amdModuleId)),"string"==typeof a.cjsModuleId&&a.cjsModuleId&&e.push("cjsModuleId="+encodeURIComponent(a.cjsModuleId)),e.join("&")},u=function(a,b,c){if("function"==typeof b.indexOf)return b.indexOf(a,c);var d,e=b.length;for("undefined"==typeof c?c=0:0>c&&(c=e+c),d=c;e>d;d++)if(b.hasOwnProperty(d)&&b[d]===a)return d;return-1},v=function(a){if("string"==typeof a)throw new TypeError("ZeroClipboard doesn't accept query strings.");return a.length?a:[a]},w=function(a,b,c,d,e){e?window.setTimeout(function(){a.call(b,c,d)},0):a.call(b,c,d)},x=function(a){var b,c;return a&&("number"==typeof a&&a>0?b=a:"string"==typeof a&&(c=parseInt(a,10))&&!isNaN(c)&&c>0&&(b=c)),b||("number"==typeof I.zIndex&&I.zIndex>0?b=I.zIndex:"string"==typeof I.zIndex&&(c=parseInt(I.zIndex,10))&&!isNaN(c)&&c>0&&(b=c)),b||0},y=function(a,b){if(a&&b!==!1&&"undefined"!=typeof console&&console&&(console.warn||console.log)){var c="`"+a+"` is deprecated. See docs for more info:\n    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";console.warn?console.warn(c):console.log(c)}},z=function(){var a,b,c,d,e,f,g=arguments[0]||{};for(a=1,b=arguments.length;b>a;a++)if(null!=(c=arguments[a]))for(d in c)if(c.hasOwnProperty(d)){if(e=g[d],f=c[d],g===f)continue;void 0!==f&&(g[d]=f)}return g},A=function(a){if(null==a||""===a)return null;if(a=a.replace(/^\s+|\s+$/g,""),""===a)return null;var b=a.indexOf("//");a=-1===b?a:a.slice(b+2);var c=a.indexOf("/");return a=-1===c?a:-1===b||0===c?null:a.slice(0,c),a&&".swf"===a.slice(-4).toLowerCase()?null:a||null},B=function(){var a=function(a,b){var c,d,e;if(null!=a&&"*"!==b[0]&&("string"==typeof a&&(a=[a]),"object"==typeof a&&"length"in a))for(c=0,d=a.length;d>c;c++)if(a.hasOwnProperty(c)&&(e=A(a[c]))){if("*"===e){b.length=0,b.push("*");break}-1===u(e,b)&&b.push(e)}},b={always:"always",samedomain:"sameDomain",never:"never"};return function(c,d){var e,f=d.allowScriptAccess;if("string"==typeof f&&(e=f.toLowerCase())&&/^always|samedomain|never$/.test(e))return b[e];var g=A(d.moviePath);null===g&&(g=c);var h=[];a(d.trustedOrigins,h),a(d.trustedDomains,h);var i=h.length;if(i>0){if(1===i&&"*"===h[0])return"always";if(-1!==u(c,h))return 1===i&&c===g?"sameDomain":"always"}return"never"}}(),C=function(a){if(null==a)return[];if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},D=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&delete a[b];return a},E=function(){var a=!1;if("boolean"==typeof d.noflash)a=d.noflash===!1;else{if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(a=!0)}catch(b){}!a&&navigator.mimeTypes["application/x-shockwave-flash"]&&(a=!0)}return a},F=function(a,b){return this instanceof F?(this.id=""+f++,g[this.id]={instance:this,elements:[],handlers:{}},a&&this.glue(a),"undefined"!=typeof b&&(y("new ZeroClipboard(elements, options)",I.debug),F.config(b)),this.options=F.config(),"boolean"!=typeof d.noflash&&(d.noflash=!E()),void(d.noflash===!1&&d.wrongflash!==!0&&null===d.bridge&&(d.wrongflash=!1,d.ready=!1,L()))):new F(a,b)};F.prototype.setText=function(a){return a&&""!==a&&(e["text/plain"]=a,d.ready===!0&&d.bridge&&d.bridge.setText(a)),this},F.prototype.setSize=function(a,b){return d.ready===!0&&d.bridge&&d.bridge.setSize(a,b),this};var G=function(a){d.ready===!0&&d.bridge&&d.bridge.setHandCursor(a)};F.prototype.destroy=function(){this.unglue(),this.off(),delete g[this.id]};var H=function(){var a,b,c,d=[],e=C(g);for(a=0,b=e.length;b>a;a++)c=g[e[a]].instance,c&&c instanceof F&&d.push(c);return d};F.version="1.3.0-beta.1";var I={moviePath:"ZeroClipboard.swf",trustedDomains:window.location.host?[window.location.host]:[],useNoCache:!0,forceHandCursor:!1,zIndex:999999999,debug:!0,title:null};F.config=function(a){if("object"==typeof a&&null!==a&&z(I,a),"string"!=typeof a||!a){var b={};for(var c in I)I.hasOwnProperty(c)&&(b[c]="object"==typeof I[c]&&null!==I[c]?"length"in I[c]?I[c].slice(0):z({},I[c]):I[c]);return b}return I.hasOwnProperty(a)?I[a]:void 0},F.destroy=function(){F.deactivate();for(var a in g)if(g.hasOwnProperty(a)&&g[a]){var b=g[a].instance;b&&"function"==typeof b.destroy&&b.destroy()}var c=M(d.bridge);c&&c.parentNode&&(c.parentNode.removeChild(c),d.ready=null,d.bridge=null)},F.activate=function(a){c&&(p(c,I.hoverClass),p(c,I.activeClass)),c=a,o(a,I.hoverClass),N();var b=I.title||a.getAttribute("title");if(b){var e=M(d.bridge);e&&e.setAttribute("title",b)}var f=I.forceHandCursor===!0||"pointer"===k(a,"cursor");G(f)},F.deactivate=function(){var a=M(d.bridge);a&&(a.style.left="0px",a.style.top="-9999px",a.removeAttribute("title")),c&&(p(c,I.hoverClass),p(c,I.activeClass),c=null)};var J=null,K=null,L=function(){var a,b,c=document.getElementById("global-zeroclipboard-html-bridge");if(!c){var e=F.config();e.amdModuleId=J,e.cjsModuleId=K;var f=B(window.location.host,I),g=t(e),h=I.moviePath+s(I.moviePath,I),i='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+h+'"/>         <param name="allowScriptAccess" value="'+f+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+g+'"/>         <embed src="'+h+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+f+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+g+'"           scale="exactfit">         </embed>       </object>';c=document.createElement("div"),c.id="global-zeroclipboard-html-bridge",c.setAttribute("class","global-zeroclipboard-container"),c.style.position="absolute",c.style.left="0px",c.style.top="-9999px",c.style.width="15px",c.style.height="15px",c.style.zIndex=""+x(I.zIndex),document.body.appendChild(c),c.innerHTML=i}a=document["global-zeroclipboard-flash-bridge"],a&&(b=a.length)&&(a=a[b-1]),d.bridge=a||c.children[0].lastElementChild},M=function(a){for(var b=/^object|embed$/,c=a&&a.parentNode;c&&b.test(c.tagName.toLowerCase())&&c.parentNode;)c=c.parentNode;return c||null},N=function(){if(c){var a=r(c,I.zIndex),b=M(d.bridge);b&&(b.style.top=a.top+"px",b.style.left=a.left+"px",b.style.width=a.width+"px",b.style.height=a.height+"px",b.style.zIndex=a.zIndex+1),d.ready===!0&&d.bridge&&d.bridge.setSize(a.width,a.height)}return this};F.dispatch=function(a,b){if("string"==typeof a&&a){var d=a.toLowerCase().replace(/^on/,"");if(d)for(var e=c?P(c):H(),f=0,g=e.length;g>f;f++)O.call(e[f],d,b)}},F.prototype.on=function(a,b){for(var c=a.toString().split(/\s+/),e={},f=g[this.id]&&g[this.id].handlers,h=0,i=c.length;i>h;h++)a=c[h].toLowerCase().replace(/^on/,""),e[a]=!0,f[a]||(f[a]=[]),f[a].push(b);return e.noflash&&d.noflash&&O.call(this,"onNoFlash",{}),e.wrongflash&&d.wrongflash&&O.call(this,"onWrongFlash",{flashVersion:d.version}),e.load&&d.ready&&O.call(this,"onLoad",{flashVersion:d.version}),this},F.prototype.off=function(a,b){var c,d,e,f,h,i=g[this.id]&&g[this.id].handlers;if(0===arguments.length?f=C(i):"string"==typeof a&&a&&(f=a.split(/\s+/)),f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),h=i[a],h&&h.length)if(b)for(e=u(b,h);-1!==e;)h.splice(e,1),e=u(b,h,e);else i[a].length=0;return this},F.prototype.handlers=function(a){var b,c=null,d=g[this.id]&&g[this.id].handlers;if(d){if("string"==typeof a&&a)return d[a]?d[a].slice(0):null;c={};for(b in d)d.hasOwnProperty(b)&&d[b]&&(c[b]=d[b].slice(0))}return c};var O=function(f,h){f=f.toLowerCase().replace(/^on/,"");var i=h&&h.flashVersion&&a(h.flashVersion)||null,j=c,k=!0;switch(f){case"load":if(i){if(!b(i))return void O.call(this,"onWrongFlash",{flashVersion:i});d.wrongflash=!1,d.ready=!0,d.version=i}break;case"wrongflash":i&&!b(i)&&(d.wrongflash=!0,d.ready=!1,d.version=i);break;case"mouseover":o(j,I.hoverClass);break;case"mouseout":F.deactivate();break;case"mousedown":o(j,I.activeClass);break;case"mouseup":p(j,I.activeClass);break;case"datarequested":var l=j.getAttribute("data-clipboard-target"),m=l?document.getElementById(l):null;if(m){var n=m.value||m.textContent||m.innerText;n&&this.setText(n)}else{var q=j.getAttribute("data-clipboard-text");q&&this.setText(q)}k=!1;break;case"complete":D(e)}var r=g[this.id]&&g[this.id].handlers[f];if(r&&r.length){var s,t,u;for(s=0,t=r.length;t>s;s++)u=r[s],"string"==typeof u&&"function"==typeof window[u]&&(u=window[u]),"function"==typeof u&&w(u,j,this,h,k)}};F.prototype.glue=function(a){a=v(a);for(var b=0;b<a.length;b++)if(a.hasOwnProperty(b)&&a[b]&&1===a[b].nodeType){a[b].zcClippingId?-1===u(this.id,i[a[b].zcClippingId])&&i[a[b].zcClippingId].push(this.id):(a[b].zcClippingId="zcClippingId_"+h++,i[a[b].zcClippingId]=[this.id],m(a[b],"mouseover",l));var c=g[this.id].elements;-1===u(a[b],c)&&c.push(a[b])}return this},F.prototype.unglue=function(a){var b=g[this.id];if(b){"undefined"==typeof a&&(a=b.elements.slice(0)),a=v(a);for(var c=0;c<a.length;c++)if(a.hasOwnProperty(c)&&a[c]&&1===a[c].nodeType){for(var d=b.elements,e=0;-1!==(e=u(a[c],d,e));)d.splice(e,1);var f=i[a[c].zcClippingId];if(f){for(e=0;-1!==(e=u(this.id,f,e));)f.splice(e,1);0===f.length&&(n(a[c],"mouseover",l),delete a[c].zcClippingId)}}}return this},F.prototype.elements=function(){var a=g[this.id];return a&&a.elements?a.elements.slice(0):[]};var P=function(a){var b,c,d,e,f,h=[];if(a&&1===a.nodeType&&(b=a.zcClippingId)&&i.hasOwnProperty(b)&&(c=i[b],c&&c.length))for(d=0,e=c.length;e>d;d++)f=g[c[d]].instance,f&&f instanceof F&&h.push(f);return h};I.hoverClass="zeroclipboard-is-hover",I.activeClass="zeroclipboard-is-active",I.trustedOrigins=null,I.allowScriptAccess=null,F.detectFlashSupport=function(){var a=I.debug;return y("ZeroClipboard.detectFlashSupport",a),E()},F.prototype.setHandCursor=function(a){return y("ZeroClipboard.prototype.setHandCursor",I.debug),a="boolean"==typeof a?a:!!a,G(a),I.forceHandCursor=a,this},F.prototype.reposition=function(){return y("ZeroClipboard.prototype.reposition",I.debug),N()},F.prototype.receiveEvent=function(a,b){if(y("ZeroClipboard.prototype.receiveEvent",I.debug),"string"==typeof a&&a){var c=a.toLowerCase().replace(/^on/,"");c&&O.call(this,c,b)}},F.prototype.setCurrent=function(a){return y("ZeroClipboard.prototype.setCurrent",I.debug),F.activate(a),this},F.prototype.resetBridge=function(){return y("ZeroClipboard.prototype.resetBridge",I.debug),F.deactivate(),this},F.prototype.setTitle=function(a){if(y("ZeroClipboard.prototype.setTitle",I.debug),a=a||I.title||c&&c.getAttribute("title")){var b=M(d.bridge);b&&b.setAttribute("title",a)}return this},F.setDefaults=function(a){y("ZeroClipboard.setDefaults",I.debug),F.config(a)},F.prototype.addEventListener=function(){return y("ZeroClipboard.prototype.addEventListener",I.debug),this.on.apply(this,[].slice.call(arguments,0))},F.prototype.removeEventListener=function(){return y("ZeroClipboard.prototype.removeEventListener",I.debug),this.off.apply(this,[].slice.call(arguments,0))},F.prototype.ready=function(){return y("ZeroClipboard.prototype.ready",I.debug),d.ready===!0},"function"==typeof define&&define.amd?define(["require","exports","module"],function(a,b,c){return J=c&&c.id||null,F}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?(K=module.id||null,module.exports=F):window.ZeroClipboard=F}();var TeamPoker=TeamPoker||{};TeamPoker.UI=TeamPoker.UI||{},"localStorage"in window&&null!==window.localStorage&&(Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))},Storage.prototype.getObject=function(a){return this.getItem(a)&&JSON.parse(this.getItem(a))}),TeamPoker.Constants={POKER_VALUES:["0","0.5","1","2","3","5","8","13","20","40","100","?"]},SocketClient.prototype={Listeners:{},ServerUrl:"",connect:function(){var a={"sync disconnect on unload":!1};this.socket=io.connect(this.ServerUrl,a);var b=this,c=location.pathname.substring(1);console.log('Connected to Socket server, namespace: "'+c+'".'),this.socket.on(c,function(a){console.log("Client received message: "),console.log(a),b.Listeners[a.MsgType]&&b.Listeners[a.MsgType].length&&_(b.Listeners[a.MsgType]).each(function(b){b(a.Data)})})},sendMsg:function(a,b){this.socket.emit(a,b)},addListener:function(a,b){this.Listeners[a]=this.Listeners[a]||[],this.Listeners[a].push(b)}},TeamPoker.SocketClient=new SocketClient([location.protocol,"//",location.host].join("")),TeamPoker.SocketClient.connect(),WidgetBase.prototype={constructor:WidgetBase,init:function(a){a=a||$(document.body),this.WidgetDOM&&a.append(this.WidgetDOM)},show:function(){if(!this.WidgetDOM)throw new Error("Cannot show this widget without seting WidgetDOM!");this.WidgetDOM.show(),this.onShown.length&&this.onShown.forEach(function(a){a()})},hide:function(){if(!this.WidgetDOM)throw new Error("Cannot show this widget without seting WidgetDOM!");this.WidgetDOM.hide(),this.onHidden.length&&this.onHidden.forEach(function(a){a()})}},TeamPoker.UI.WidgetBase=WidgetBase,PopUp.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.PopUp=PopUp,ShareLinkPopup.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.ShareLinkPopup=ShareLinkPopup,LoginForm.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.LoginForm=LoginForm,PokerQueue.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.PokerQueue=PokerQueue,ParticipantList.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.ParticipantList=ParticipantList,TeamPoker.UIManager={ParticipantsList:null,StoryPointer:null,PokerQueue:null,VoteResultDialog:null,IsCreatingRoom:"/"===location.pathname,init:function(){if($("#btn-logout").click(function(a){a.preventDefault(),TeamPoker.logout(),location.reload()}),$.cookie("LoginName"))TeamPoker.login($.cookie("LoginName"));else{var a=new TeamPoker.UI.LoginForm;a.init(),a.show()}$("#btnViewResult").click(TeamPoker.viewVoteResult),this.ParticipantList=new TeamPoker.UI.ParticipantList,this.PokerQueue=new TeamPoker.UI.PokerQueue,this.PokerQueue.init(),this.PokerQueue.ListenerQueue["USER-VOTE"]=[function(a){TeamPoker.vote(a)}],this.PokerQueue.show()},loadRoomInfo:function(a){$("#txt-room-link").val(location.href);var b=new ZeroClipboard($("#btn-copy"),{moviePath:"javascripts/vendor/ZeroClipboard.swf"});$(b.htmlBridge).tooltip({title:"Copy Room Link!",placement:"bottom"}),this.initStoryTable(a),this.ParticipantList.init(a.ParticipantCollection)},newParticipant:function(a,b){this.ParticipantList.addParticipant(a,b)},leaveParticipant:function(a){this.ParticipantList.removeFromParticipantsList(a)},initStoryTable:function(a){_(a.StoryCollection).each(function(a,b){TeamPoker.UIManager.addStoryRow({Id:b,Title:a.Title,Point:a.Point})}),a.CurrentVotingStory?(TeamPoker.CurrentVotingStory=a.CurrentVotingStory,this.setStoryPointer(a.CurrentVotingStory)):this.setStoryPointer(parseInt($("#story-table > tbody > tr:first").attr("story-id"))),$("#btn-add-story").click(function(){TeamPoker.UIManager.addStoryRow()})},setStoryPointer:function(a){TeamPoker.CurrentVotingStory=a,this.StoryPointer&&this.StoryPointer.remove();var b=$("<span>").attr("id","pointer").attr("class","glyphicon glyphicon-circle-arrow-left").attr("draggable","true");b.tooltip({title:"Drag to change story",placement:"right",delay:{show:200,hide:0}}),b[0].addEventListener("dragstart",function(a){a.dataTransfer.effectAllowed="move"}),this.StoryPointer=b,$("#story-table > tbody > tr[story-id="+a+"] > td:eq(2)").append(b),this.PokerQueue.show(),this.ParticipantList.resetVoteStatus()},addStoryRow:function(a){{var b=document.getElementById("story-table").tBodies[0],c=b.insertRow(0),d=$(c.insertCell(0)),e=$(c.insertCell(1));$(c.insertCell(2))}if(a)d.html(a.Title),a.Point&&e.html(a.Point),$(c).attr("story-id",a.Id);else{var f=$("#story-table > tbody > tr:last").attr("story-id")||0;$(c).attr("story-id",parseInt(f)+1),0===f&&this.setStoryPointer($(c.cells[2]))}b.appendChild(c),this.bindEventForStoryRow(c),a||$(c.cells[0]).click()},bindEventForStoryRow:function(a){$([a.cells[0],a.cells[1]]).on("click",TeamPoker.UIManager.changeStoryContent),this.makeCellDraggable(a.cells[2])},makeCellDraggable:function(a){a.addEventListener("dragover",function(a){a.preventDefault(),a.dataTransfer.dropEffect="move",$(this).addClass("dragover")}),a.addEventListener("dragleave",function(){$(this).removeClass("dragover")}),a.addEventListener("drop",function(){$(this).removeClass("dragover"),$(this).append(TeamPoker.UIManager.StoryPointer),TeamPoker.setCurrentStory(parseInt($(this).parent().attr("story-id"))),TeamPoker.UIManager.ParticipantList.resetVoteStatus(),TeamPoker.UIManager.PokerQueue.show()})},changeStoryContent:function(){var a=$(this),b=parseInt($(this).parent().attr("story-id")),c=$(this).html(),d=$("<input>").attr("type","text").val($(this).text());a.off("click"),d.on("blur",function(){var d=$(this).val();if(d!==c){0===this.parentElement.cellIndex?TeamPoker.updateStoryInfo(b,{Title:d}):1===this.parentElement.cellIndex&&TeamPoker.updateStoryInfo(b,{Point:d})}a.html($(this).val()),a.on("click",TeamPoker.UIManager.changeStoryContent)}),a.html(""),a.append(d),d.focus()},updateStoryInfo:function(a){$("#story-table > tbody > tr[story-id="+a.Id+"]").length?"Title"in a.Val?$("#story-table > tbody > tr[story-id="+a.Id+"] > td:eq(0)").html(a.Val.Title):"Point"in a.Val&&$("#story-table > tbody > tr[story-id="+a.Id+"] > td:eq(1)").html(a.Val.Point):this.addStoryRow({Id:a.Id,Title:a.Val.Title,Point:a.Val.Point})},onUserVote:function(a){TeamPoker.UIManager.ParticipantList.updateVoteStatus(a)},displayVoteResult:function(a){console.log("Displaying vote result: "),console.log(a);var b=$("#story-table > tbody > tr[story-id="+TeamPoker.CurrentVotingStory+"] > td:eq(0)").html();this.VoteResultDialog=new TeamPoker.UI.VoteResultDialog(b,a),this.VoteResultDialog.init(),this.VoteResultDialog.ListenerQueue["RE-VOTE"]=[function(){TeamPoker.UIManager.updateStoryInfo({Id:TeamPoker.CurrentVotingStory,Val:{Point:""}}),TeamPoker.UIManager.PokerQueue.show(),TeamPoker.UIManager.ParticipantList.resetVoteStatus(),TeamPoker.reVote()}],this.VoteResultDialog.ListenerQueue["SAVE-POINT"]=[function(a){TeamPoker.UIManager.updateStoryInfo({Id:TeamPoker.CurrentVotingStory,Val:{Point:a}}),TeamPoker.UIManager.PokerQueue.show(),TeamPoker.savePoint(a)}],this.VoteResultDialog.show()},revoteForStory:function(a){this.updateStoryInfo({Id:a,Val:{Point:""}}),this.PokerQueue.show(),this.VoteResultDialog&&this.VoteResultDialog.hide(),this.ParticipantList.resetVoteStatus()},savePointForStory:function(a,b){this.updateStoryInfo({Id:a,Val:{Point:b}}),this.PokerQueue.show(),this.VoteResultDialog&&this.VoteResultDialog.hide(),this.ParticipantList.resetVoteStatus()},cleanUp:function(){sessionStorage.clear()}},$(document).ready(function(){TeamPoker.UIManager.init()}),$(window).on("beforeunload",function(){return"You are about to leave Team Poker..."}),$(window).unload(function(){TeamPoker.logout(),TeamPoker.UIManager.cleanUp()}),VoteResultDialog.prototype=Object.create(TeamPoker.UI.WidgetBase.prototype),TeamPoker.UI.VoteResultDialog=VoteResultDialog,TeamPoker.CurrentVoterName="",TeamPoker.CurrentVoterId=0,TeamPoker.CurrentVotingStory=0,TeamPoker.MessageType={LoginCallback:"LoginCallback",NewParticipant:"NewParticipant",LeaveParticipant:"LeaveParticipant",ParticipantVoted:"ParticipantVoted",SetCurrentStory:"SetCurrentStory",UpdateStoryInfo:"UpdateStoryInfo",ViewVoteResult:"ViewVoteResult",Revote:"Revote",SavePoint:"SavePoint",GameStatus:"GameStatus"},TeamPoker.login=function(a){TeamPoker.SocketClient.sendMsg("login_event",a)},TeamPoker.loginCallback=function(a){"true"===a.Success?(TeamPoker.CurrentVoterId=a.ParticipantInfo.Id,TeamPoker.CurrentVoterName=a.ParticipantInfo.Name,TeamPoker.UIManager.loadRoomInfo(a.RoomInfo),sessionStorage.setObject("RoomInfo",a.RoomInfo)):alert("Oops! Some error occured result in Login attempt failed! Please try again:)")},TeamPoker.logout=function(){$.removeCookie("LoginName"),TeamPoker.SocketClient.sendMsg("logout_event",TeamPoker.CurrentVoterId)},TeamPoker.newParticipantCallback=function(a){TeamPoker.UIManager.newParticipant(a.Id,a.Name)},TeamPoker.leaveParticipantCallback=function(a){TeamPoker.UIManager.leaveParticipant(a.Id)},TeamPoker.setCurrentStory=function(a){TeamPoker.CurrentVotingStory=a,TeamPoker.SocketClient.sendMsg("set_current_story_event",a)},TeamPoker.setCurrentStoryCallback=function(a){TeamPoker.UIManager.setStoryPointer(a.StoryId)},TeamPoker.updateStoryInfo=function(a,b){TeamPoker.SocketClient.sendMsg("update_story_event",{Id:a,Val:b})},TeamPoker.updateStoryInfoCallback=function(a){TeamPoker.UIManager.updateStoryInfo(a.StoryInfo)},TeamPoker.vote=function(a){TeamPoker.SocketClient.sendMsg("vote_event",{StoryId:TeamPoker.CurrentVotingStory,VoterId:TeamPoker.CurrentVoterId,VoterName:TeamPoker.CurrentVoterName,VoteVal:a})},TeamPoker.voteCallback=function(a){TeamPoker.UIManager.onUserVote(a.VoterId)
},TeamPoker.viewVoteResult=function(){TeamPoker.SocketClient.sendMsg("view_vote_result_event",TeamPoker.CurrentVotingStory)},TeamPoker.viewVoteResultCallback=function(a){_(a.VoteStatus).each(function(a){"?"===a.VoteVal||"0"===a.VoteVal?a.SpecialScore=!0:a.VoteVal=parseFloat(a.VoteVal)});var b=_.chain(a.VoteStatus).pluck("VoteVal").without("?","0").sort(function(a,b){return a-b}).uniq();b.value().length>2&&_(a.VoteStatus).each(function(a){a.VoteVal===b.first().value()&&(a.LowScore=!0),a.VoteVal===b.last().value()&&(a.HighScore=!0)}),TeamPoker.UIManager.displayVoteResult(a.VoteStatus)},TeamPoker.reVote=function(){TeamPoker.SocketClient.sendMsg("revote_event",TeamPoker.CurrentVotingStory)},TeamPoker.reVoteCallback=function(a){TeamPoker.UIManager.revoteForStory(a.Id)},TeamPoker.savePoint=function(a){TeamPoker.SocketClient.sendMsg("save_point_event",{Id:TeamPoker.CurrentVotingStory,Point:a})},TeamPoker.savePointCallback=function(a){TeamPoker.UIManager.savePointForStory(a.Id,a.Point)},TeamPoker.SocketClient.addListener(TeamPoker.MessageType.LoginCallback,TeamPoker.loginCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.GameStatus,TeamPoker.onLoadGameStatus),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.NewParticipant,TeamPoker.newParticipantCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.LeaveParticipant,TeamPoker.leaveParticipantCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.ParticipantVoted,TeamPoker.voteCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.SetCurrentStory,TeamPoker.setCurrentStoryCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.UpdateStoryInfo,TeamPoker.updateStoryInfoCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.ViewVoteResult,TeamPoker.viewVoteResultCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.Revote,TeamPoker.reVoteCallback),TeamPoker.SocketClient.addListener(TeamPoker.MessageType.SavePoint,TeamPoker.savePointCallback);